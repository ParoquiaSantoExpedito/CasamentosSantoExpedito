<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendário 2026 - Casamentos Maringá</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #8B5E3C; /* caramelo marrom suave */
    color: #3E1F0D;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #7C4A23; /* terracota */
    margin-bottom: 10px;
  }
  #calendario {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    max-width: 1000px;
    margin: 0 auto 30px auto;
    background-color: #A9746E; /* caramelo claro */
    padding: 10px;
    border-radius: 8px;
  }
  .dia-semana {
    font-weight: bold;
    text-align: center;
    padding: 5px 0;
    color: #7C4A23; /* terracota */
  }
  .dia {
    min-height: 70px;
    background-color: #D9B08C; /* caramelo */
    border-radius: 5px;
    padding: 5px;
    user-select: none;
    text-align: right;
    position: relative;
    font-weight: normal;
    cursor: default; /* fica pointer só nos sábados em modo editor */
  }
  .feriado {
    background-color: #E07B52; /* terracota mais forte */
    color: white;
    font-weight: bold;
  }
  .feriado-santo {
    background-color: #C37C3E; /* terracota santo */
    color: white;
    font-weight: bold;
  }
  .disponivel {
    background-color: #4B7A44 !important; /* verde disponível */
    color: white;
    font-weight: bold;
  }
  .indisponivel {
    background-color: #B54141 !important; /* vermelho indisponível */
    color: white;
    font-weight: bold;
  }
  #modo-editor {
    max-width: 1000px;
    margin: 0 auto;
    background-color: #A9746E;
    padding: 15px;
    border-radius: 8px;
    color: #3E1F0D;
  }
  #senha-container {
    text-align: center;
    margin-bottom: 10px;
  }
  #senha {
    padding: 5px;
    font-size: 16px;
    width: 150px;
    border-radius: 4px;
    border: 1px solid #7C4A23;
  }
  #botao-entrar, #botao-salvar {
    padding: 7px 15px;
    font-size: 16px;
    margin-left: 5px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background-color: #7C4A23;
    color: white;
    font-weight: bold;
  }
  #botao-entrar:hover, #botao-salvar:hover {
    background-color: #5a3517;
  }
  #mensagem {
    text-align: center;
    margin-top: 10px;
    font-weight: bold;
  }
  #legenda {
    max-width: 1000px;
    margin: 20px auto;
    display: flex;
    justify-content: center;
    gap: 20px;
    color: #3E1F0D;
  }
  .legenda-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
  }
  .legenda-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
  }
  .leg-feriado { background-color: #E07B52; }
  .leg-feriado-santo { background-color: #C37C3E; }
  .leg-disponivel { background-color: #4B7A44; }
  .leg-indisponivel { background-color: #B54141; }
</style>
</head>
<body>

<h1>Calendário 2026 - Casamentos Maringá</h1>

<div id="calendario"></div>

<div id="legenda">
  <div class="legenda-item"><div class="legenda-color leg-feriado"></div>Feriado</div>
  <div class="legenda-item"><div class="legenda-color leg-feriado-santo"></div>Feriado Santo</div>
  <div class="legenda-item"><div class="legenda-color leg-disponivel"></div>Sábado Disponível</div>
  <div class="legenda-item"><div class="legenda-color leg-indisponivel"></div>Sábado Indisponível</div>
</div>

<div id="modo-editor">
  <div id="senha-container">
    <input type="password" id="senha" placeholder="Digite a senha para editar" />
    <button id="botao-entrar">Entrar</button>
  </div>
  <div id="editor-controles" style="display:none; text-align:center; margin-top:10px;">
    <button id="botao-salvar">Salvar alterações</button>
    <div id="mensagem"></div>
  </div>
</div>

<!-- Firebase compat libs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  // Config Firebase (pública do front-end)
  const firebaseConfig = {
    apiKey: "AIzaSyCNhoW4B6EkIe4jCp8grJiXGNRer6Q9tNs",
    authDomain: "calendariodecasamentos2026.firebaseapp.com",
    databaseURL: "https://calendariodecasamentos2026-default-rtdb.firebaseio.com/",
    projectId: "calendariodecasamentos2026",
    storageBucket: "calendariodecasamentos2026.appspot.com",
    messagingSenderId: "610947771106",
    appId: "1:610947771106:web:b3213b288ccb647c9a4cbb"
  };

  // Inicializa Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const ano = 2026;
  const calendarioEl = document.getElementById('calendario');
  const senhaInput = document.getElementById('senha');
  const botaoEntrar = document.getElementById('botao-entrar');
  const editorControles = document.getElementById('editor-controles');
  const botaoSalvar = document.getElementById('botao-salvar');
  const mensagemEl = document.getElementById('mensagem');
  const senhaCorreta = "1904";
  let modoEditor = false;
  let estados = {}; // status dos sábados

  // Feriados 2026 (YYYY-MM-DD)
  const feriados = {
    "2026-01-01": { nome: "Confraternização Universal", tipo: "feriado" },
    "2026-02-17": { nome: "Carnaval", tipo: "feriado" },
    "2026-02-18": { nome: "Carnaval", tipo: "feriado" },
    "2026-04-02": { nome: "Sexta-feira Santa", tipo: "feriado-santo" },
    "2026-04-21": { nome: "Tiradentes", tipo: "feriado" },
    "2026-05-01": { nome: "Dia do Trabalho", tipo: "feriado" },
    "2026-06-11": { nome: "Corpus Christi", tipo: "feriado-santo" },
    "2026-07-20": { nome: "Aniversário de Maringá", tipo: "feriado" },
    "2026-09-07": { nome: "Independência do Brasil", tipo: "feriado" },
    "2026-10-12": { nome: "Nossa Senhora Aparecida", tipo: "feriado-santo" },
    "2026-11-02": { nome: "Finados", tipo: "feriado-santo" },
    "2026-11-15": { nome: "Proclamação da República", tipo: "feriado" },
    "2026-12-25": { nome: "Natal", tipo: "feriado-santo" }
  };

  const diasSemana = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];

  // --- RENDERIZAÇÃO ---
  function criarCalendario() {
    if (!calendarioEl) return;
    calendarioEl.innerHTML = "";

    // Cabeçalhos
    for (let d = 0; d < 7; d++) {
      const div = document.createElement('div');
      div.classList.add('dia-semana');
      div.textContent = diasSemana[d];
      calendarioEl.appendChild(div);
    }

    // 2026 não é bissexto (mantém 28 em Fev)
    const diasMes = [31,28,31,30,31,30,31,31,30,31,30,31];

    // espaços antes do 1º dia do ano (para alinhar a grade)
    const dataInicio = new Date(ano, 0, 1);
    const diaSemanaInicio = dataInicio.getDay(); // 0=Dom, ... 6=Sáb
    for (let i = 0; i < diaSemanaInicio; i++) {
      const vazio = document.createElement('div');
      vazio.classList.add('dia');
      vazio.style.background = 'transparent';
      calendarioEl.appendChild(vazio);
    }

    // Dias do ano em grade contínua (sem quebra por mês)
    for (let mes = 0; mes < 12; mes++) {
      for (let dia = 1; dia <= diasMes[mes]; dia++) {
        const dateStr = `${ano}-${String(mes + 1).padStart(2,'0')}-${String(dia).padStart(2,'0')}`;
        const div = document.createElement('div');
        div.classList.add('dia');
        div.textContent = dia;

        // Marca feriados
        if (feriados[dateStr]) {
          if (feriados[dateStr].tipo === "feriado-santo") {
            div.classList.add('feriado-santo');
          } else {
            div.classList.add('feriado');
          }
          div.title = feriados[dateStr].nome;
        }

        // Sábados: estado clicável no modo editor
        const dataObj = new Date(ano, mes, dia);
        if (dataObj.getDay() === 6) {
          if (estados[dateStr] === "disponivel") {
            div.classList.add('disponivel');
          } else if (estados[dateStr] === "indisponivel") {
            div.classList.add('indisponivel');
          }

          if (modoEditor) {
            div.style.cursor = "pointer";
            div.addEventListener('click', () => {
              if (estados[dateStr] === "disponivel") {
                estados[dateStr] = "indisponivel";
              } else if (estados[dateStr] === "indisponivel") {
                delete estados[dateStr];
              } else {
                estados[dateStr] = "disponivel";
              }
              criarCalendario();
            });
          }

          // Tooltip combinando feriado + estado
          const nomeFeriado = feriados[dateStr] ? feriados[dateStr].nome : "";
          const estadoTxt = estados[dateStr] ? estados[dateStr].toUpperCase() : "Sem info";
          div.title = (nomeFeriado ? nomeFeriado + " - " : "") + estadoTxt;
        }

        calendarioEl.appendChild(div);
      }
    }
  }

  // --- FIREBASE: carregar/salvar ---
  function carregarEstados() {
    // Tenta carregar uma vez; se falhar, mantém render local
    return db.ref('estados').once('value')
      .then(snapshot => {
        estados = snapshot.val() || {};
        criarCalendario();
      })
      .catch(err => {
        console.warn("Falha ao ler do Firebase (seguindo sem dados remotos):", err);
        criarCalendario();
      });
  }

  function salvarEstados() {
    botaoSalvar.disabled = true;
    mensagemEl.textContent = "Salvando...";
    db.ref('estados').set(estados)
      .then(() => {
        mensagemEl.textContent = "Salvo com sucesso!";
      })
      .catch(() => {
        mensagemEl.textContent = "Erro ao salvar. Verifique as regras do Firebase.";
      })
      .finally(() => {
        botaoSalvar.disabled = false;
      });
  }

  function ativarModoEditor() {
    modoEditor = true;
    editorControles.style.display = "block";
    senhaInput.disabled = true;
    botaoEntrar.disabled = true;
    criarCalendario();
  }

  function desativarModoEditor() {
    modoEditor = false;
    editorControles.style.display = "none";
    senhaInput.disabled = false;
    botaoEntrar.disabled = false;
    senhaInput.value = "";
    criarCalendario();
  }

  // --- Eventos UI ---
  botaoEntrar.addEventListener('click', () => {
    if (senhaInput.value === senhaCorreta) {
      ativarModoEditor();
      mensagemEl.textContent = "";
    } else {
      mensagemEl.textContent = "Senha incorreta!";
      setTimeout(() => { mensagemEl.textContent = ""; }, 3000);
    }
  });

  botaoSalvar.addEventListener('click', salvarEstados);

  // Atualizações em tempo real (se permitido)
  db.ref('estados').on('value',
    snapshot => {
      const val = snapshot.val();
      if (val) {
        estados = val;
        criarCalendario();
      }
    },
    err => {
      console.warn("Sem acesso em tempo real ao Firebase:", err);
    }
  );

  // --- Inicialização ---
  // 1) Render local imediato (não bloqueia pela rede)
  criarCalendario();
  // 2) Tenta sincronizar com Firebase
  carregarEstados();
</script>

</body>
</html>
